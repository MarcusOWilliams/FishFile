{% extends "base.html" %}
    

{% block content %}
{%if fish%}
<div id="fishInformation">
    <div class="fishInfoBlock">
        <h2>Fish</h2>
        <p class = "fishInfoPoint"><span class="pointHeader">Fish ID: </span>{{fish.fish_id}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Tank ID: </span>{{fish.tank_id}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Stock#: </span>{{fish.stock}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Status: </span>{{fish.status}}</p>
        {%if fish.protocol != None and fish.protocol != ""%}
            <P class = "fishInfoPoint"><span class="pointHeader">Protocol: </span>{{fish.protocol}}</P>
        {%endif%}
        <p class = "fishInfoPoint"><span class="pointHeader">Birthday: </span>{{fish.birthday}} {%if fish.getAge()%}(Age: {{fish.getAge()}}){%endif%}</p>
        {%if fish.date_of_arrival != None and fish.date_of_arrival != ""%}
            <p class = "fishInfoPoint"><span class="pointHeader">Date of Arrival: </span>{{fish.date_of_arrival}}</p>
        {%endif%}
        <p class = "fishInfoPoint"><span class="pointHeader">Source: </span>{{fish.source}}</p>
    </div>
    <div class="fishInfoBlock">
        <h2>Users</h2>
        <p class = "fishInfoPoint"><span class="pointHeader">Project License Allocated: </span><a href="{{url_for('main.project_license', license = fish.project_license_holder.project_license)}}" target=”_blank”>{{fish.project_license_holder.project_license}}</a></p>
        <p class = "fishInfoPoint"><span class="pointHeader">User Code: </span><a href = "{{url_for('main.user', username = fish.user_code.username)}}" target=”_blank”>{{fish.user_code.code}}</a></p>
    </div>
    <div class="fishInfoBlock">
        <h2>Genetics</h2>
        <p class = "fishInfoPoint"><span class="pointHeader">Mutant Gene: </span>{{fish.mutant_gene}}</p>
        {%if fish.transgenes != None and fish.transgenes != ""%}
            <p class = "fishInfoPoint"><span class="pointHeader">Transgenes: </span>{{fish.transgenes}}</p>
        {%endif%}
        {%if fish.allele != None and fish.allele != ""%}
            <p class = "fishInfoPoint"><span class="pointHeader">Allele: </span>{{fish.allele}}</p>
        {%endif%}
        <p class = "fishInfoPoint"><span class="pointHeader">Type of Cross: </span>{{fish.cross_type}}</p>
        {%if fish.father != None%}
            <p class = "fishInfoPoint"><span class="pointHeader">Father:</span> ID = {{fish.father.fish_id}}, Stock = {{fish.father.stock}} <a href="{{url_for('main.fish', id=fish.father.id)}}" target=”_blank”>(view entry)</a></p>
        {%endif%}
        {%if fish.mother != None%}
            <p class = "fishInfoPoint"><span class="pointHeader">Mother:</span> ID = {{fish.mother.fish_id}}, Stock = {{fish.mother.stock}} <a href="{{url_for('main.fish', id=fish.mother.id)}}" target=”_blank”>(view entry)</a></p>
        {%endif%}
        {%if fish.fathered |length > 0 %}
            <p class = "fishInfoPoint"><span class="pointHeader">Fathered Fish:</span></p>
            {%for fish in fish.fathered%}
                <p class = "fishInfoPoint fishSubpoint">{{fish}} <a href="{{url_for('main.fish', id=fish.id)}}" target=”_blank”>(view entry)</a></p>
            {%endfor%}
        {%endif%}
        {%if fish.mothered |length > 0%}
            <p class = "fishInfoPoint"><span class="pointHeader">Mothered Fish:</span></p>
            {%for fish in fish.mothered%}
                <p class = "fishInfoPoint fishSubpoint">{{fish}} <a href="{{url_for('main.fish', id=fish.id)}}" target=”_blank”>(view entry)</a></p>
            {%endfor%}
        {%endif%}
    </div>
    <div class="fishInfoBlock">
        <h2>Tank Count</h2>
        <p class = "fishInfoPoint"><span class="pointHeader">Males: </span>{{fish.males}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Females: </span>{{fish.females}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Unsexed: </span>{{fish.unsexed}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Carriers: </span>{{fish.carriers}}</p>
        <p class = "fishInfoPoint"><span class="pointHeader">Total: </span>{{fish.total}}</p>
    </div>
    <div class="fishInfoBlock">
        <h2>Comments and Reminders</h2><br>
        {%if fish.comments != None and fish.comments != ""%}
            <p class = "fishInfoPoint"><span class="pointHeader">Comments: </span>{{fish.comments}}</p><br>
        {%else%}
            <p class = "fishInfoPoint"><span class="pointHeader">Comments: </span>No comments...</p><br>
        {%endif%}
        {%if fish.reminders.count() >0%}
            <p class = "fishInfoPoint"><span class="pointHeader">Current reminders:</span>
                {%for reminder in fish.reminders%}
                    <p class = "fishInfoPoint" style="margin-left:20px;">{%if reminder.message%} Reminder: {{reminder.message}},{%endif%} {%if reminder.date%} Date: {{reminder.date}} {%endif%}</p>
                {%endfor%}
            </p>
        {%else%}
            <p class = "fishInfoPoint"><span class="pointHeader">Reminders: </span>No reminders...</p>
        {%endif%}

    </div>
    <div class="fishInfoBlock">
        <h2>More Options</h2>
        <p class="fishInfoPoint moreFishOptionsItem"><a href="{{url_for('main.fishhistory', id = fish.id)}}">View the genetic history of this fish</a></p>
        <p class="fishInfoPoint moreFishOptionsItem"><a href="{{url_for('main.fishchange', id = fish.id, filters= 'all')}}">View the previous changes for this entry</a></p>
        {%if current_user.isResearcher()%}
            <p class="fishInfoPoint moreFishOptionsItem"><a href="{{url_for('main.updatefish', id = fish.id)}}">Update informtation for this entry</a></p>
        {%endif%}
        <br>
        {% if current_user.isAdmin() %}
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteFishModal" style="margin-left: 20px; margin-bottom:20px;">
                Delete Fish Entry
            </button>
            <!-- Modal -->
            <div class="modal fade" id="deleteFishModal" tabindex="-1" aria-labelledby="deleteFishModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="deleteFishModalLabel">Are you sure?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this entry? You will not be able to recover it after this.
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <form action="{{ url_for('main.deletefish', id = fish.id)}}" method="post">
                        {{ form.hidden_tag() }}
                        {{ form.submit(value='Delete Fish Entry', class="btn btn-danger") }}
                    </form>
                    </div>
                </div>
                </div>
            </div>
           
        {%endif%}
    </div>
</div>
<br>
<textarea style="width:80%;" id="copyText">ID, Tank ID, Stock, Status, Protocol, Birthday, Date of Arrival, Source, Project License, User code, Mutant gene, Transgenes, Cross Type, Father ID, Father Stock, Mother ID, Mother Stock, Males, Females, Unsexed, Carriers, Total
{{fish.fish_id}}, {{fish.tank_id}}, {{fish.stock}}, {{fish.status}}, {{fish.protocol}}, {{fish.birthday}}, {{fish.date_of_arrival}}, {{fish.source}}, {{fish.project_license_holder.project_license}}, {{fish.user_code.code}}, {{fish.mutant_gene}}, {{fish.transgenes}}, {{fish.cross_type}}, {{fish.father.fish_id}}, {{fish.father.stock}}, {{fish.mother.fish_id}}, {{fish.mother.stock}}, {{fish.males}}, {{fish.females}}, {{fish.unsexed}}, {{fish.carriers}}, {{fish.total}}

        </textarea><br>
<button id="copybtn" class="btn btn-secondary" data-clipboard-action="copy" data-clipboard-target="#copyText" style="margin-bottom:20px">
    Copy fish data to clipboard <i class="bi bi-clipboard-fill"></i>
</button>
<br>

<!-- Include clipboard.js -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
<!-- Instantiate clipboard -->
<script>
    var btn = document.getElementById('copybtn');
    var clipboard = new ClipboardJS(btn);

    clipboard.on('success', function (e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
    });

    clipboard.on('error', function (e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
    });
</script>
{%else%}
    <h2>A fish matching this information could not be found</h2>
    <p>Try altering your search conditions on the <a href="{{url_for('main.index')}}">home page</a></p>
{%endif%}




{%endblock%}